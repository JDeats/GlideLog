<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:GlideLog.ViewModels"
             xmlns:models="clr-namespace:GlideLog.Models"
             x:Class="GlideLog.Views.FlightListView"
             x:DataType="vm:FlightListViewModel"
             xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit">

    <ContentPage.Resources>
        <Style x:Key="FlightListStyle" TargetType="Grid">
            <Setter Property="BackgroundColor" Value="#404040"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="5,1"/>
        </Style>
    </ContentPage.Resources>

    <Grid>
        <CollectionView
            x:Name="FlightCollectionView"
            VerticalOptions="Fill"
            ItemsSource="{Binding Flights}"
            SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:FlightEntryModel">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Delete" BackgroundColor="#874242" 
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FlightListViewModel}}, Path=DeleteFlightCommand}"
                                           CommandParameter="{Binding .}"/>
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Border Style="{StaticResource FlightListStyle}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FlightListViewModel}}, Path=EditFlightCommand}" CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>
                            <VerticalStackLayout>
                                <Grid RowDefinitions="auto, auto, auto" ColumnDefinitions="auto, *" >
                                    <HorizontalStackLayout>
                                        <Label Text="Date: "/>
                                        <Label Text="{Binding DateTime, StringFormat='{0:MM/dd/yy hh:mm tt}'}"/>
                                    </HorizontalStackLayout>

                                    <HorizontalStackLayout Grid.Row="1">
                                        <Label Text="Site: "/>
                                        <Label Text="{Binding Site}"/>
                                    </HorizontalStackLayout>

                                    <HorizontalStackLayout Grid.Row="2">
                                        <Label Text="Glider: "/>
                                        <Label Text="{Binding Glider}"/>
                                    </HorizontalStackLayout>

                                    <HorizontalStackLayout Grid.Column="1" HorizontalOptions="End">
                                        <Label Text="Flights: " />
                                        <Label Text="{Binding FlightCount}" HorizontalTextAlignment="End"/>
                                    </HorizontalStackLayout>

                                    <HorizontalStackLayout Grid.Column="1" Grid.Row="1" HorizontalOptions="End">
                                        <Label Text="Hours: " />
                                        <Label Text="{Binding Hours, StringFormat='{0:D2}:'}" HorizontalTextAlignment="End" Padding="0"/>
                                        <Label Text="{Binding Minutes, StringFormat='{0:D2}'}" HorizontalTextAlignment="End" Padding="0"/>
                                    </HorizontalStackLayout>
                                    <Label Text="{Binding Notes}" Grid.Column="1" Grid.Row="2" HeightRequest="21" HorizontalOptions="End"/>
                                </Grid>

                            </VerticalStackLayout>
                        </Border>

                    </SwipeView>

                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        <Button
            ImageSource="{StaticResource IconAdd}" 
            BackgroundColor="Gray" 
            CornerRadius="30" 
            HeightRequest="60" 
            WidthRequest="60" 
            VerticalOptions="End" 
            HorizontalOptions="End"
            Margin="30" 
            SemanticProperties.Description="Add" 
            Command="{Binding AddFlightCommand}"/>
    </Grid>
</ContentPage>